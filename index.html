<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Zambrano Cool Run</title>
  <style>
    body { margin: 0; background:#111; display:flex; justify-content:center; align-items:center; height:100vh; font-family: Arial, sans-serif; }
    canvas { background:#ffd400; border:4px solid #000; }
    #overlay {
      position:absolute; text-align:center; color:#000; font-weight:bold;
      background:rgba(255,255,255,0.88); padding:18px 16px; border-radius:12px;
      max-width: 320px;
    }
    button { padding:10px 18px; font-size:16px; cursor:pointer; border:2px solid #000; border-radius:10px; }
  </style>
</head>
<body>
  <canvas id="game" width="360" height="600"></canvas>
  <div id="overlay">
    üöó‚ùÑÔ∏è<br/>
    <h2 style="margin:8px 0;">Zambrano Cool Run</h2>
    <p style="margin:8px 0 14px;">Toca o arrastra para mover el carro.<br/>Recoge la botella de refrigerante.</p>
    <button id="btnStart">Jugar</button>
    <div style="margin-top:10px;font-size:12px;opacity:.8;">Radiadores Zambrano</div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const btnStart = document.getElementById('btnStart');

  let car, coolant, score, running;
  let roadOffset = 0;

  // --- Tiny pixel-art sprites (drawn in-code, no assets needed) ---
  const SPRITES = {
    car: [
      "....KKK....",
      "...KRRRK...",
      "..KRRRRRK..",
      ".KRRRRRRK.",
      "KRRRBBRRRK",
      "KRRBBBBRRK",
      "KRRRBBRRRK",
      ".KRRRRRRK.",
      "..KRRRRRK..",
      "...KRRRK...",
      "....KKK....",
    ],
    bottle: [
      "....GG....",
      "...GWWG...",
      "...GWWG...",
      "..GWWWWG..",
      "..GWWWWG..",
      "..GWWWWG..",
      "..GWWWWG..",
      "..GWWWWG..",
      "...GWWG...",
      "...GWWG...",
      "....GG....",
    ]
  };

  const PALETTE = {
    '.': null,
    K: '#111111', // outline
    R: '#ff2b2b', // red car
    B: '#2b6bff', // blue detail
    G: '#00b3ff', // coolant bottle
    W: '#e6f7ff'  // label highlight
  };

  function spriteSize(sprite, scale){
    return { w: sprite[0].length*scale, h: sprite.length*scale };
  }

  function drawSprite(sprite, x, y, scale){
    for(let row=0; row<sprite.length; row++){
      const line = sprite[row];
      for(let col=0; col<line.length; col++){
        const ch = line[col];
        const color = PALETTE[ch];
        if(!color) continue;
        ctx.fillStyle = color;
        ctx.fillRect(x + col*scale, y + row*scale, scale, scale);
      }
    }
  }

  function resetGame(){
    const carScale = 4;
    const bottleScale = 3;

    const carSz = spriteSize(SPRITES.car, carScale);
    const botSz = spriteSize(SPRITES.bottle, bottleScale);

    car = {
      x: (canvas.width - carSz.w)/2,
      y: canvas.height - (carSz.h + 24),
      w: carSz.w,
      h: carSz.h,
      scale: carScale
    };

    coolant = {
      x: Math.random() * (canvas.width - botSz.w),
      y: -botSz.h,
      w: botSz.w,
      h: botSz.h,
      scale: bottleScale
    };

    score = 0;
    roadOffset = 0;
    running = true;
  }

  function startGame(){
    overlay.style.display='none';
    resetGame();
    requestAnimationFrame(loop);
  }

  // Input (mobile + desktop)
  canvas.style.touchAction = 'none';

  function setCarX(clientX){
    const rect = canvas.getBoundingClientRect();
    const x = clientX - rect.left;
    car.x = x - car.w/2;
    if(car.x < 0) car.x = 0;
    if(car.x + car.w > canvas.width) car.x = canvas.width - car.w;
  }

  canvas.addEventListener('pointerdown', (e) => {
    if(!running) return;
    e.preventDefault();
    setCarX(e.clientX);
  });

  canvas.addEventListener('pointermove', (e) => {
    if(!running) return;
    if(e.pointerType === 'mouse' && e.buttons === 0) return;
    e.preventDefault();
    setCarX(e.clientX);
  });

  // Fallback touch for some browsers
  canvas.addEventListener('touchstart', (e) => {
    if(!running) return;
    e.preventDefault();
    setCarX(e.touches[0].clientX);
  }, { passive:false });

  canvas.addEventListener('touchmove', (e) => {
    if(!running) return;
    e.preventDefault();
    setCarX(e.touches[0].clientX);
  }, { passive:false });

  btnStart.addEventListener('click', startGame);

  function drawRoad(){
    // Retro sky
    ctx.fillStyle = '#2b6bff';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Distant horizon band
    ctx.fillStyle = '#1f8f3a';
    ctx.fillRect(0, 92, canvas.width, 18);

    // Road trapezoid
    const topY = 110;
    const bottomY = canvas.height;
    const topW = 130;
    const bottomW = 320;
    const centerX = canvas.width/2;

    ctx.fillStyle = '#2a2a2a';
    ctx.beginPath();
    ctx.moveTo(centerX - topW/2, topY);
    ctx.lineTo(centerX + topW/2, topY);
    ctx.lineTo(centerX + bottomW/2, bottomY);
    ctx.lineTo(centerX - bottomW/2, bottomY);
    ctx.closePath();
    ctx.fill();

    // Grass shoulders
    ctx.fillStyle = '#1f8f3a';
    ctx.beginPath();
    ctx.moveTo(0, topY);
    ctx.lineTo(centerX - topW/2, topY);
    ctx.lineTo(centerX - bottomW/2, bottomY);
    ctx.lineTo(0, bottomY);
    ctx.closePath();
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(centerX + topW/2, topY);
    ctx.lineTo(canvas.width, topY);
    ctx.lineTo(canvas.width, bottomY);
    ctx.lineTo(centerX + bottomW/2, bottomY);
    ctx.closePath();
    ctx.fill();

    // Perspective helper
    const dashH = 26;
    const gap = 16;
    roadOffset = (roadOffset + 7) % (dashH + gap);

    // Center dashed line
    ctx.fillStyle = '#ffffff';
    for(let y = topY; y < bottomY; y += (dashH + gap)){
      const yy = y + roadOffset;
      const t = (yy - topY) / (bottomY - topY);
      const dashW = 5 + t*10;
      const x = centerX - dashW/2;
      const h = dashH * (0.55 + t);
      ctx.fillRect(x, yy, dashW, h);
    }

    // Edge stripes
    function edgeXLeft(y){
      const t = (y - topY)/(bottomY-topY);
      return centerX - (topW/2 + t*(bottomW-topW)/2);
    }
    function edgeXRight(y){
      const t = (y - topY)/(bottomY-topY);
      return centerX + (topW/2 + t*(bottomW-topW)/2);
    }

    for(let y=topY; y<bottomY; y+=40){
      const yy = y + (roadOffset*0.6);
      const t = (yy - topY) / (bottomY - topY);
      const stripeW = 6 + t*10;
      const stripeH = 14 + t*16;
      ctx.fillStyle = '#ff2b2b';
      ctx.fillRect(edgeXLeft(yy) - stripeW, yy, stripeW, stripeH);
      ctx.fillRect(edgeXRight(yy), yy, stripeW, stripeH);
    }

    // Simple clouds
    ctx.fillStyle = '#e6f7ff';
    ctx.fillRect(40, 28, 26, 10);
    ctx.fillRect(56, 22, 22, 10);
    ctx.fillRect(64, 32, 18, 8);

    ctx.fillRect(240, 40, 30, 10);
    ctx.fillRect(258, 34, 18, 10);
    ctx.fillRect(270, 44, 16, 8);
  }

  function loop(){
    if(!running) return;

    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawRoad();

    // Move bottle
    coolant.y += 6;

    // Collision (AABB)
    if(
      coolant.x < car.x + car.w &&
      coolant.x + coolant.w > car.x &&
      coolant.y < car.y + car.h &&
      coolant.y + coolant.h > car.y
    ){
      score++;
      coolant.y = -coolant.h;
      coolant.x = Math.random() * (canvas.width - coolant.w);
    }

    // Miss -> game over
    if(coolant.y > canvas.height + 40){
      running = false;
      overlay.innerHTML = `üî• FIN DEL JUEGO üî•<br/>Refrigerante: ${score}<br/><br/>Radiadores Zambrano<br/><br/><button id="btnRetry">Reintentar</button>`;
      overlay.style.display = 'block';
      document.getElementById('btnRetry').addEventListener('click', () => {
        // restore original overlay content quickly
        overlay.innerHTML = `üöó‚ùÑÔ∏è<br/><h2 style="margin:8px 0;">Zambrano Cool Run</h2><p style="margin:8px 0 14px;">Toca o arrastra para mover el carro.<br/>Recoge la botella de refrigerante.</p><button id="btnStart">Jugar</button><div style="margin-top:10px;font-size:12px;opacity:.8;">Radiadores Zambrano</div>`;
        document.getElementById('btnStart').addEventListener('click', startGame);
      });
      return;
    }

    // Draw sprites
    drawSprite(SPRITES.bottle, coolant.x, coolant.y, coolant.scale);
    drawSprite(SPRITES.car, car.x, car.y, car.scale);

    // HUD
    ctx.fillStyle = '#111';
    ctx.font = '16px Arial';
    ctx.fillText('Refrigerante: ' + score, 10, 22);
  }

})();
</script>
</body>
</html>
